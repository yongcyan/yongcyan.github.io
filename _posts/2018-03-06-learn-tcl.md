---
layout: post
title:  TCL one-pager
date:   2018-03-06 17:39:11 +0800
tags:   [ ]
---

Table of Contents:

[For Beginner](#for-beginner)
 * [Condition](#condition)
 * [Looping](#looping)
 * [Functions](#functions)
 * [Error Catch](#error-catch)
 * [Regular Expressions](#regular-expressions)

[Useful functions](#useful-functions)
 * [List](#list)
 * [String](#string)
 * [Array](#array)
 * [Dictionary](#dictionary)
 * [File Access](#file-access)
 * [Math](#math)
 * [Built-In Commands](#built-in-commands)

## For Beginner

Tcl命令实际上是词语的列表，使用要执行表示该命令的第一个字。接下来的单词代表参数。为了组单词组成单一的参数，随函多个单词可使用“”或{}。

> commandName argument1 argument2 ... argumentN
{% highlight tcl %}
% puts stdout "Hello, world!"
Hello, world!
% puts [expr 1 + 6 + 9]
16
% set a 3 ; puts $a
3
% puts "Hello\nWorld"
Hello
World
% 
{% endhighlight %}

> * set variableName value 用于指定值的变量
> * $variableName 用于获取变量的值

*不同于其他语言，在TCL，只有一个字时，不需要包含双引号*
{% highlight tcl %}
% set var hello world ; puts $var
wrong # args: should be "set varName ?newValue?"
% set var "hello world" ; puts $var
hello world
% set var {hello world} ; puts $var
hello world
% puts [lindex $var 1]
world
% 
{% endhighlight %}

> expr 用于表示数学表达式
{% highlight tcl %}
% puts [expr 10 / 9]
1
% puts [expr 10.0 / 9]
1.1111111111111112
% set tcl_precision 5
5
% puts [expr 10.0 / 9]
1.1111
% 
{% endhighlight %}

> Exp1 ? Exp2 : Exp3;
{% highlight tcl %}
% puts [expr 1 == 2 ? true : false]
false
% 
{% endhighlight %}


#### Condition

**if**
{% highlight tcl %}
# if {boolean_expression 1} {
#   # Executes when the boolean expression 1 is true
# } elseif {boolean_expression 2} {
#    # Executes when the boolean expression 2 is true 
# } elseif {boolean_expression 3} {
#    # Executes when the boolean expression 3 is true 
# } else {
#    # executes when the none of the above condition is true 
# }

% if {1 < 2} { puts "less than" }
less than
% 
{% endhighlight %}

**switch**
{% highlight tcl %}
# switch switchingString {
#    matchString1 {
#       body1
#    }
#    matchString2 {
#       body2
#    }
# ...
#    matchStringn {
#       bodyn
#    }
# }

% set grade B
% switch $grade A { puts "Well done!" }  B { puts "Excellent!" }  C { puts "You passed!" } F { puts "Better try again" }   default { puts "Invalid grade" }
Excellent!
% 
{% endhighlight %}


#### Looping

**while**
{% highlight tcl %}
# while {condition} {
#    statement(s)
# }

% set a 10
10
% while {$a < 17} { puts $a ; incr a }
10
11
12
13
14
15
16
% 
{% endhighlight %}

**for**
{% highlight tcl %}
# for {initialization} {condition} {increment} {
#    statement(s);
# }

% for {set a 10} {$a < 12} {incr a} { puts "value of a: $a" }
value of a: 10
value of a: 11
% 
{% endhighlight %}

**break**
> break语句用于终止循环。当循环中遇到break语句，循环立即终止，程序控制继续循环体后面的语句。
{% highlight tcl %}
% for {set a 10} {$a < 15} {incr a} { puts "value of a: $a" ; if {$a
% == 11} break }
value of a: 10
value of a: 11
% 
{% endhighlight %}

**continue**
> continue并不强制终止，而是继续强制循环的下一个迭代发生，跳过中间的代码。
{% highlight tcl %}
% for {set a 10} {$a < 15} {incr a} { if {$a == 13} continue ; puts
% "value of a: $a" }
value of a: 10
value of a: 11
value of a: 12
value of a: 14
% 
{% endhighlight %}


#### Functions

{% highlight bash %}
[yoyang@yoyang-pc ~]$ cat test.tcl
#!/usr/bin/tclsh

proc helloWorld {} {
   puts "Hello, World!"
}
helloWorld
[yoyang@yoyang-pc ~]$ ./test.tcl
Hello, World!
{% endhighlight %}

**可变参数（默认参数）**
{% highlight bash %}
[yoyang@yoyang-pc ~]$ cat ./test.tcl
#!/usr/bin/tclsh

proc avg { {numbers 0} } {
        set sum 0
        foreach number $numbers {
                set sum [expr $sum + $number]
        }
        set average [expr $sum/[llength $numbers]]
        return $average
}
puts [avg {70 80 50 60}]
puts [avg {70 80 50}]
puts [avg]
[yoyang@yoyang-pc ~]$ ./test.tcl
65
66
0
{% endhighlight %}

**递归**
{% highlight bash %}
[yoyang@yoyang-pc ~]$ cat test.tcl
#!/usr/bin/tclsh

proc sum {number} {
        if {$number <= 1} {
                return 1
        }
        return [expr $number + [sum [expr $number - 1]]]
}
puts [sum 100]
[yoyang@yoyang-pc ~]$ ./test.tcl
5050
{% endhighlight %}


#### Error Catch

> * error message info code
> * catch script resultVarName
{% highlight bash %}
[yoyang@yoyang-pc ~]$ ./test.tcl
ErrorMsg: Error generated by error
ErrorCode: 401
ErrorInfo:
Info String for error
    (procedure "Div" line 1)
    invoked from within
"Div 10 0"

Result = 5
[yoyang@yoyang-pc ~]$ cat ./test.tcl
#!/usr/bin/tclsh

proc Div {a b} {
        if {$b == 0} {
                error "Error generated by error" "Info String for error" 401
        } else {
                return [expr $a/$b]
        }
}

if {[catch {puts "Result = [Div 10 0]"} errmsg]} {
        puts "ErrorMsg: $errmsg"
        puts "ErrorCode: $errorCode"
        puts "ErrorInfo:\n$errorInfo\n"
}

if {[catch {puts "Result = [Div 10 2]"} errmsg]} {
        puts "ErrorMsg: $errmsg"
        puts "ErrorCode: $errorCode"
        puts "ErrorInfo:\n$errorInfo\n"
}
{% endhighlight %}


#### Regular Expressions

> regexp optionalSwitches patterns searchString fullMatch subMatch1 ... subMatchn
> * -nocase : 用于忽略大小写。
> * -indices : 匹配的子模式，而不是匹配的字符存储的位置。
> * -line : 新行敏感匹配。换行后忽略字符。
> * -start index : 搜索模式开始设置偏移
> * -- : 标志着开关的结束

{% highlight tcl %}
% regexp {([A-Z,a-z]*).([A-Z,a-z]*)} "Tcl Tutorial" a b c
1
% puts $a
Tcl Tutorial
% puts $b
Tcl
% puts $c
Tutorial
{% endhighlight %}



## Useful functions

Tcl提供了一些内置的功能(程序)，用于各种操作。这包括，

* [列表处理函数](#list)

* [字符串处理函数](#string)

* [数组处理函数](#array)

* [字典处理函数](#dictionary)

* [文件I/O处理函数](#file-access)

* 命名空间和包处理函数

* [数学处理函数](#math)

* [操作系统处理函数](#built-in-commands)


#### List

* lappend listName value
* llength listName
* lindex listname index
* linsert listname index value1 value2..valuen
* lreplace listname firstindex lastindex value1 value2..valuen
* lset listname index value
* lassign listname variable1 variable2.. variablen
* lsort listname
{% highlight tcl %}
% set list {red green blue}
red green blue
% set list [list red green blue]
red green blue
% set list [split "red,green,blue" ,]
red green blue
% append list "s"
red green blues
% lappend list "black"
red green blues black
% 
% puts [llength $list]
4
%
% puts [lindex $list 3]
black
%
{% endhighlight %}


#### String

**string命令**
<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>compare string1 string2</td>
      <td>比较string1和string2的字典顺序。如果相等返回0，如果string1在string2出现之前返回-1，否则返回1。</td>
    </tr>
    <tr>
      <td>first string1 string2</td>
      <td>返回string2中第一次出现string1索引的位置。如果没有找到，返回-1。</td>
    </tr>
    <tr>
      <td>last string1 string2</td>
      <td>返回string1在string2中最后一次出现的索引。如果没有找到，返回-1。</td>
    </tr>
    <tr>
      <td>index string index</td>
      <td>返回string中index索引的字符。</td>
    </tr>
    <tr>
      <td>length string</td>
      <td>返回字符串string的长度。</td>
    </tr>
    <tr>
      <td>match pattern string</td>
      <td>如果该字符串匹配模式则返回1。</td>
    </tr>
    <tr>
      <td>range string index1 index2</td>
      <td>返回指定索引范围index1到index2内的字符串。</td>
    </tr>
    <tr>
      <td>tolower string</td>
      <td>返回小写字符串。</td>
    </tr>
    <tr>
      <td>toupper string</td>
      <td>返回大写字符串。</td>
    </tr>
    <tr>
      <td>trim string ?trimcharacters?</td>
      <td>删除字符串两端的trimcharacters。默认trimcharacters是空白。</td>
    </tr>
    <tr>
      <td>trimleft string ?trimcharacters?</td>
      <td>删除字符串左侧开始的trimcharacters。默认trimcharacters是空白。</td>
    </tr>
    <tr>
      <td>trimright string ?trimcharacters?</td>
      <td>删除字符串左端trimcharacters。默认trimcharacters是空白。</td>
    </tr>
    <tr>
      <td>wordend findstring index</td>
      <td>返回索引字符findstring包含字符索引单词。</td>
    </tr>
    <tr>
      <td>wordstart findstring index</td>
      <td>返回findstring中第一个字符的含有索引中的字符索引的单词</td>
    </tr>
  </tbody>
</table>
{% highlight tcl %}
% set s1 Hello
Hello
% set s2 World
World
% set s3 World
World
% puts [string compare $s1 $s2]
-1
% puts [string compare $s2 $s3]
0
% puts [string first $s1 o]
-1
% puts [string first o $s1]
4
% 
{% endhighlight %}

**append命令**
{% highlight tcl %}
% set s1 "Hello" 
Hello
% append s1 " World"
Hello World
% puts $s1
Hello World
% 
{% endhighlight %}

**format命令**
{% highlight tcl %}
% puts [format "%s" "Tcl Language"]
Tcl Language
% puts [format "%d %s" 4 tuts]
4 tuts
% puts [format "%f" 43.5]
43.500000
% puts [format "%x" 15]
f
% 
{% endhighlight %}

**scan命令**
{% highlight tcl %}
% puts [scan "124" { %[0-9] } m]
1
% puts [scan "abc" { %[0-9] } m]
0
% puts [scan "abc" { %[a-z] } m]
1
% 
{% endhighlight %}


#### Array

**数组**
> set ArrayName(Index) value
{% highlight tcl %}
% set students(0) Bob
Bob
% set students(1) "Alice Yang"
Alice Yang
% set students(2) Charles
Charles
% puts [array size students]
3
% for { set index 0 }  { $index < [array size students] } { incr index
% } { puts "STUDENTS($index) is $students($index)" }
STUDENTS(0) is Bob
STUDENTS(1) is Alice Yang
STUDENTS(2) is Charles
%
{% endhighlight %}


**关联数组**
{% highlight tcl %}
% set fullname(Bob) "Booby Wong"
Booby Wong
% set fullname(Charles) "Charles Wei"
Charles Wei
% puts [array names fullname]
Charles Bob
% foreach index [array names fullname] { puts "full name of $index is $fullname($index)" }
full name of Charles is Charles Wei
full name of Bob is Booby Wong
%
{% endhighlight %}


#### Dictionary

{% highlight tcl %}
% dict set colours  colour1 red
colour1 red
% dict set colours  colour2 green
colour1 red colour2 green
% puts $colours
colour1 red colour2 green
%
% set colours [dict create colour1 "black" colour2 "white"]
colour1 black colour2 white
%
{% endhighlight %}


#### File Access

* open fileName accessMode
> accessMode includes: r w a r+ w+ a+
* close fileName
* puts $fileName "text to write"
* set file_data [read $fileName]
* gets $fileName data
{% highlight bash %}
[yoyang@yoyang-pc ~]$ cat test.tcl
#!/usr/bin/tclsh

set fp [open "tcl_testfile" w+]
puts $fp "test1\ntest2"
close $fp

set fp [open "tcl_testfile" r]
while { [gets $fp data] >= 0 } {
        puts $data
        puts "wait for a while"
}
close $fp
[yoyang@yoyang-pc ~]$ ./test.tcl
test1
wait for a while
test2
wait for a while
[yoyang@yoyang-pc ~]$
{% endhighlight %}


#### Math

[Ref: TCL内置函数](https://www.yiibai.com/tcl/tcl_builtin_functions.html#article-start)
<table>
  <thead>
    <tr>
      <th>Method Name</th>
      <th>Descriptions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>abs arg</td>
      <td>计算arg的绝对值。</td>
    </tr>
    <tr>
      <td>ceil arg</td>
      <td>计算比最小整数大于或等于的一个数。</td>
    </tr>
    <tr>
      <td>double arg</td>
      <td>计算arg如果是一个浮点值，返回arg，否则arg转换为浮点，并返回转换后的值。</td>
    </tr>
    <tr>
      <td>floor arg</td>
      <td>计算比最大的整数小于或等于arg。</td>
    </tr>
    <tr>
      <td>pow x y</td>
      <td>计算y的x的幂值。如果x为负，y必须是一个整数值。</td>
    </tr>
    <tr>
      <td>rand</td>
      <td>计算0和1之间的伪随机数。</td>
    </tr>
    <tr>
      <td>srand arg</td>
      <td>计算0和1之间所述arg一个伪随机数，它必须是一个整数，用来复位的种子随机数发生器。</td>
    </tr>
  </tbody>
</table>


#### Built-In Commands

* clock - 秒函数返回当前时间以秒为单位。
* clock format - 格式化函数格式化秒到的日期和时间。
* clock scan - 扫描函数扫描输入字符串，并将其转换为秒。
* open - 函数用于打开一个文件。
* exec - 函数用于执行一个系统命令。
* close - 函数用于关闭一个文件。
{% highlight tcl %}
% set currentTime [clock seconds]
1520481589
% puts "The time is: [clock format $currentTime -format %H:%M:%S]"
The time is: 11:59:49
% puts "The date is: [clock format $currentTime -format %D]"
The date is: 03/08/2018
%
% puts [exec pwd]
/home/yoyang
%
{% endhighlight %}


[Back to top]()
